<!-- Mobile Menu -->
<div id="mobileMenu" class="fixed inset-0 z-50 md:hidden hidden" role="dialog" aria-modal="true">
  <div 
    class="fixed inset-0 bg-black/60 backdrop-blur-sm" 
    aria-hidden="true"
    id="mobileMenuBackdrop"
  ></div>

  <nav class="fixed top-0 left-0 z-50 h-full w-full max-w-sm bg-[#7f49a7ff] p-6 shadow-2xl">
    <div class="flex items-center justify-between mb-10">
      <a href="/" class="text-3xl font-bold text-[#eebff0ff]" id="mobileMenuLogo">
        Fix & Fast
      </a>
      <button 
        type="button" 
        class="-m-2.5 p-2.5 text-[#eebff0ff]"
        id="closeMobileMenu"
      >
        <span class="sr-only">Close menu</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="space-y-4" id="mobileMenuLinks">
      <!-- Links will be populated by JavaScript based on auth state -->
    </div>
  </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const menu = document.getElementById('mobileMenu');
  const backdrop = document.getElementById('mobileMenuBackdrop');
  const closeBtn = document.getElementById('closeMobileMenu');
  const menuLinks = document.getElementById('mobileMenuLinks');
  const logo = document.getElementById('mobileMenuLogo');

  function getUser() {
    return auth.getCurrentUser();
  }

  function getActiveLinkClass(isActive) {
    return isActive
      ? 'block text-2xl font-medium bg-[#e498d1ff] px-4 py-3 rounded-lg text-[#FFFFFF]'
      : 'block text-2xl font-medium px-4 py-3 rounded-lg text-[#eebff0ff] hover:bg-[#4B0082]';
  }

  function isCurrentPage(path) {
    return window.location.pathname === path;
  }

  function closeMenu() {
    menu.classList.add('hidden');
  }

  function updateMenuLinks() {
    const user = getUser();
    menuLinks.innerHTML = '';

    if (user) {
      logo.href = '/dashboard';
      
      const links = [
        { path: '/dashboard', text: 'Dashboard' },
        { path: '/tickets', text: 'Tickets' }
      ];

      links.forEach(link => {
        const a = document.createElement('a');
        a.href = link.path;
        a.className = getActiveLinkClass(isCurrentPage(link.path));
        a.textContent = link.text;
        a.addEventListener('click', closeMenu);
        menuLinks.appendChild(a);
      });

      // Add separator
      const hr = document.createElement('hr');
      hr.className = 'border-white/20 my-6';
      menuLinks.appendChild(hr);

      // Add logout button that uses the auth service
      const logoutBtn = document.createElement('button');
      logoutBtn.className = 'w-full text-left text-2xl font-medium px-4 py-3 rounded-lg text-red-500 hover:bg-[#4B0082]';
      logoutBtn.textContent = 'Logout';
      logoutBtn.addEventListener('click', () => {
        closeMenu();
        auth.logout();
      });
      menuLinks.appendChild(logoutBtn);
    } else {
      logo.href = '/';
      
      const authLinks = [
        { path: '/auth/login', text: 'Login' },
        { path: '/auth/signup', text: 'Sign up' }
      ];

      authLinks.forEach(link => {
        const a = document.createElement('a');
        a.href = link.path;
        a.className = getActiveLinkClass(isCurrentPage(link.path));
        a.textContent = link.text;
        a.addEventListener('click', closeMenu);
        menuLinks.appendChild(a);
      });
    }
  }

  // Show menu function (to be called from parent)
  window.showMobileMenu = function() {
    menu.classList.remove('hidden');
    updateMenuLinks();
  };

  // Close menu when clicking close button
  closeBtn.addEventListener('click', closeMenu);

  // Close menu when clicking backdrop
  backdrop.addEventListener('click', closeMenu);

  // Update links when DOM loads
  updateMenuLinks();
});
</script>
